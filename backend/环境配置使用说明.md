# 🔧 环境配置使用说明

## 📋 配置文件说明

本项目提供了多个环境配置文件，用于不同场景的部署：

### 📁 配置文件列表

| 文件名 | 用途 | 说明 |
|--------|------|------|
| `env.example` | 配置模板 | 包含所有可配置项的示例 |
| `env.development` | 开发环境 | 开发时的推荐配置 |
| `env.production` | 生产环境 | 生产部署的推荐配置 |

## 🚀 快速使用

### 开发环境
```bash
# 复制开发环境配置
cp env.development .env

# 启动开发服务
npm run dev
```

### 生产环境
```bash
# 复制生产环境配置
cp env.production .env

# 启动生产服务
npm start
```

## 🔧 环境配置对比

### 开发环境特点 (env.development)
- **日志级别**: `debug` - 详细调试信息
- **详细日志**: `true` - 输出详细日志
- **热重载**: `true` - 支持代码热重载
- **调试模式**: `true` - 启用调试功能
- **CORS**: `*` - 允许所有来源
- **JWT密钥**: 开发用简单密钥

### 生产环境特点 (env.production)
- **日志级别**: `info` - 仅重要信息
- **详细日志**: `false` - 减少日志输出
- **热重载**: `false` - 关闭热重载
- **调试模式**: `false` - 关闭调试功能
- **CORS**: 指定域名 - 安全限制
- **JWT密钥**: 生产用复杂密钥
- **并发限制**: 更高的并发处理能力

## 📊 配置项详细说明

### 服务器配置
```env
PORT=3001                    # 服务端口
NODE_ENV=development         # 环境模式
HOST=localhost              # 绑定地址
```

### Milvus配置
```env
MILVUS_HOST=localhost       # Milvus服务器地址
MILVUS_PORT=19530          # Milvus端口
MILVUS_SSL=false           # 是否使用SSL
MILVUS_ADMIN_USER=root      # 管理员用户名
MILVUS_ADMIN_PASSWORD=Milvus # 管理员密码
```

### 文件上传配置
```env
UPLOAD_DIR=./uploads        # 上传目录
MAX_FILE_SIZE=10485760      # 单文件最大10MB
ALLOWED_EXTENSIONS=jpg,jpeg,png,gif,webp # 允许的文件类型
MAX_FILES=10               # 最大文件数量
```

### 模型配置
```env
MODEL_CACHE_DIR=./.cache    # 模型缓存目录
MODEL_NAME=Marqo/marqo-fashionSigLIP # 模型名称
VECTOR_DIMENSION=768       # 向量维度
```

### 向量数据库配置
```env
COLLECTION_NAME=fashion_images # 集合名称
INDEX_TYPE=HNSW             # 索引类型
METRIC_TYPE=L2              # 距离度量
HNSW_M=16                   # HNSW参数M
HNSW_EF_CONSTRUCTION=200    # HNSW构建参数
```

### 日志配置
```env
LOG_LEVEL=debug             # 日志级别: debug/info/warn/error
DETAILED_LOGS=true          # 是否输出详细日志
```

### 安全配置
```env
JWT_SECRET=your_secret_key  # JWT密钥
CORS_ORIGIN=*               # CORS允许的来源
```

### 性能配置
```env
API_TIMEOUT=30000          # API超时时间(毫秒)
CONCURRENCY_LIMIT=5         # 并发处理限制
```

### 开发配置
```env
HOT_RELOAD=true            # 热重载
DEBUG_MODE=true            # 调试模式
```

## 🛠️ 自定义配置

### 1. 基于模板创建
```bash
# 复制模板文件
cp env.example .env

# 编辑配置文件
nano .env
```

### 2. 环境变量覆盖
```bash
# 临时设置环境变量
export PORT=8080
export NODE_ENV=production

# 启动服务
npm start
```

### 3. 多环境管理
```bash
# 开发环境
NODE_ENV=development npm run dev

# 生产环境
NODE_ENV=production npm start
```

## 🔒 安全注意事项

### 生产环境安全配置
1. **修改默认密码**
   ```env
   MILVUS_ADMIN_PASSWORD=your_secure_password
   ```

2. **设置强JWT密钥**
   ```env
   JWT_SECRET=your_very_secure_jwt_secret_key_here
   ```

3. **限制CORS来源**
   ```env
   CORS_ORIGIN=https://yourdomain.com
   ```

4. **启用SSL连接**
   ```env
   MILVUS_SSL=true
   ```

## 📈 性能优化配置

### 高并发场景
```env
CONCURRENCY_LIMIT=20
API_TIMEOUT=60000
```

### 内存优化
```env
LOG_LEVEL=warn
DETAILED_LOGS=false
```

### 缓存优化
```env
MODEL_CACHE_DIR=/tmp/model_cache
```

## 🚨 故障排除

### 配置不生效
1. 检查 `.env` 文件是否存在
2. 确认环境变量名称正确
3. 重启服务使配置生效

### 端口冲突
```bash
# 检查端口占用
netstat -ano | findstr :3001

# 修改端口
PORT=8080
```

### 文件上传失败
1. 检查 `UPLOAD_DIR` 目录是否存在
2. 确认目录有写权限
3. 检查文件大小限制

## 📝 最佳实践

1. **开发环境**: 使用 `env.development` 配置
2. **生产环境**: 使用 `env.production` 配置
3. **敏感信息**: 不要提交到版本控制
4. **定期更新**: 定期更新默认密码和密钥
5. **监控日志**: 生产环境监控日志级别

## 🔄 配置更新流程

1. 修改配置文件
2. 重启服务
3. 验证配置生效
4. 测试功能正常

---

**注意**: 请根据实际部署环境调整配置参数，确保系统安全稳定运行。
